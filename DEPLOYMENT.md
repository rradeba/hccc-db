# Deploying the Flask Backend

## Option 1: Local Development (Quick Start)

1. **Set up the database:**
   ```bash
   cd db
   python -m venv .venv
   .\.venv\Scripts\Activate.ps1  # Windows
   pip install -r requirements.txt
   ```

2. **Create environment file:**
   ```bash
   copy .env.example .env
   # Edit .env with your database URL
   ```

3. **Initialize database:**
   ```bash
   $env:FLASK_APP="wsgi.py"
   flask db init
   flask db migrate -m "Add leads table"
   flask db upgrade
   ```

4. **Run locally:**
   ```bash
   flask run --port 5050
   ```

## Option 2: Deploy to Railway (Recommended)

1. **Install Railway CLI:**
   ```bash
   npm install -g @railway/cli
   railway login
   ```

2. **Deploy:**
   ```bash
   cd db
   railway init
   railway add postgresql
   railway deploy
   ```

3. **Set environment variables in Railway dashboard:**
   - `FLASK_ENV=production`
   - `SECRET_KEY=your-secret-key`
   - `DATABASE_URL` (auto-generated by Railway)

4. **Run migrations:**
   ```bash
   railway run flask db upgrade
   ```

## Option 3: Deploy to Render

1. **Create a new Web Service on Render**
2. **Connect your GitHub repo**
3. **Set build command:** `pip install -r requirements.txt`
4. **Set start command:** `gunicorn wsgi:app`
5. **Add PostgreSQL database**
6. **Set environment variables:**
   - `FLASK_ENV=production`
   - `SECRET_KEY=your-secret-key`
   - `DATABASE_URL=postgresql://...` (from Render database)

## Option 4: Deploy to Heroku

1. **Install Heroku CLI**
2. **Create app:**
   ```bash
   cd db
   heroku create your-app-name
   heroku addons:create heroku-postgresql:mini
   ```

3. **Deploy:**
   ```bash
   git add .
   git commit -m "Add Flask backend"
   git push heroku main
   ```

4. **Run migrations:**
   ```bash
   heroku run flask db upgrade
   ```

## Update Frontend

Once deployed, update your website's environment:

1. **Create `.env` in website folder:**
   ```
   VITE_BACKEND_URL=https://your-backend-url.railway.app
   ```

2. **Or update the API_URL in `website/src/utils/formSubmission.js`**

## Testing

Test your deployed backend:
```bash
curl https://your-backend-url.railway.app/health
curl -X POST https://your-backend-url.railway.app/api/leads \
  -H "Content-Type: application/json" \
  -d '{"firstName":"Test","lastName":"User","email":"test@example.com","phone":"555-1234","streetAddress":"123 Main St","city":"Charleston","state":"SC","zip":"29401","referrer":"Google","service":["exterior"]}'
```


